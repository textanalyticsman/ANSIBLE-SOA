  - name: Getting configuration to patch Weblogic
    set_fact:
      # This query extracts the list of patches for Weblogic
      # This gets all the patches whose patch numnber is different from 28186730
      # Why?
      # This is because in my configuration file, I have put the Opatch patch and the
      # Weblogic patches all together. I think this is something that should be improved in the 
      # future
      patch_list_patches:  "{{ soa_installers | json_query('[?installer== `weblogic12214`][].patches[?patch!= `\"28186730\"`][]')  }}"
      # Even though each expression returns just one value. I used "join" to convert the variable
      # into a string
      java_home: "{{ soa_installers | json_query('[?installer == `jdk8u251`].java_home')|join(',') }}"

  - name: Unzip Weblogic patches
    unarchive:
      remote_src: yes
      src: "{{ patch_directory }}/{{ item.zipname }}"
      dest: "{{ patch_directory }}"
    loop: "{{ patch_list_patches }}"

  - name: Applying Weblogic patches
    command:  "{{ opatch_executable }} apply -jdk {{ java_home }}/bin/java -silent -oh {{oracle_home}} {{ patch_directory }}/{{item.patch}}"
    loop: "{{ patch_list_patches }}"
